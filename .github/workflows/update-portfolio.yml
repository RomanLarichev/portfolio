name: Update Portfolio Automatically

# –î–æ–±–∞–≤–ª—è–µ–º permissions –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã 403
permissions:
  contents: write    # –ü—Ä–∞–≤–æ –ø–∏—Å–∞—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
  pages: write       # –ü—Ä–∞–≤–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å GitHub Pages
  id-token: write    # –î–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é
  push:
    branches: [ main ]

jobs:
  sync-external-projects:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout portfolio
        uses: actions/checkout@v4
        
      - name: Setup Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git config pull.rebase false
          
      - name: Run sync script
        run: |
          chmod +x scripts/sync/sync-projects.sh
          ./scripts/sync/sync-projects.sh
          
      - name: Show project structure
        run: |
          echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ:"
          find . -type f -name "README.md" | sort | while read f; do
            project_dir=$(dirname "$f")
            echo "  üìÇ $project_dir"
          done

  generate-site:
    runs-on: ubuntu-latest
    needs: sync-external-projects
    if: always()
    
    steps:
      - name: Checkout portfolio
        uses: actions/checkout@v4
        
      - name: Create portfolio site
        run: |
          mkdir -p _site
          
          # –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π index.html
          cat > _site/index.html << 'HTML'
          <!DOCTYPE html>
          <html lang="ru">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ Roman Larichev</title>
              <style>
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                      max-width: 1200px;
                      margin: 0 auto;
                      padding: 40px;
                      line-height: 1.6;
                      color: #333;
                  }
                  header {
                      text-align: center;
                      margin-bottom: 60px;
                      padding: 40px 20px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      border-radius: 15px;
                  }
                  h1 {
                      font-size: 3em;
                      margin-bottom: 10px;
                  }
                  .projects-grid {
                      display: grid;
                      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                      gap: 30px;
                      margin: 40px 0;
                  }
                  .project-card {
                      border: 1px solid #e0e0e0;
                      border-radius: 15px;
                      padding: 25px;
                      background: white;
                      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
                      transition: transform 0.3s, box-shadow 0.3s;
                  }
                  .project-card:hover {
                      transform: translateY(-5px);
                      box-shadow: 0 15px 30px rgba(0,0,0,0.1);
                  }
                  .project-card h3 {
                      margin-top: 0;
                      color: #2c3e50;
                      font-size: 1.5em;
                  }
                  .tech-stack {
                      display: flex;
                      flex-wrap: wrap;
                      gap: 8px;
                      margin: 15px 0;
                  }
                  .tech-tag {
                      background: #f1f5f9;
                      padding: 5px 12px;
                      border-radius: 20px;
                      font-size: 0.9em;
                      color: #4a5568;
                  }
                  .project-link {
                      display: inline-block;
                      margin-top: 15px;
                      padding: 10px 20px;
                      background: #007acc;
                      color: white;
                      text-decoration: none;
                      border-radius: 8px;
                      font-weight: 500;
                  }
                  footer {
                      margin-top: 60px;
                      text-align: center;
                      color: #666;
                      font-size: 0.9em;
                      border-top: 1px solid #eee;
                      padding-top: 20px;
                  }
              </style>
          </head>
          <body>
              <header>
                  <h1>üë®‚Äçüíª –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ Roman Larichev</h1>
                  <p>–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ‚Ä¢ –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</p>
              </header>
              
              <section>
                  <h2>üõ†Ô∏è –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>
                  <div class="projects-grid">
                      <!-- –ü—Ä–æ–µ–∫—Ç File Organizer -->
                      <div class="project-card">
                          <h3>üóÇÔ∏è File Organizer</h3>
                          <p>–£–º–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Ñ–∞–π–ª–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π.</p>
                          
                          <div class="tech-stack">
                              <span class="tech-tag">Python</span>
                              <span class="tech-tag">hashlib</span>
                              <span class="tech-tag">logging</span>
                              <span class="tech-tag">pathlib</span>
                          </div>
                          
                          <a href="https://github.com/RomanLarichev/portfolio/tree/main/scripts/python/file-organizer" 
                             class="project-link" target="_blank">
                             –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–µ–∫—Ç ‚Üí
                          </a>
                      </div>
                      
                      <!-- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –±—É–¥—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
                      <div class="project-card" style="opacity: 0.7;">
                          <h3>üåê –í–µ–±-–ø—Ä–æ–µ–∫—Ç</h3>
                          <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–µ–≥–æ –≤–µ–±-–ø—Ä–æ–µ–∫—Ç–∞.</p>
                          <div class="tech-stack">
                              <span class="tech-tag">React</span>
                              <span class="tech-tag">Node.js</span>
                          </div>
                          <div class="project-link" style="background: #ccc;">–°–∫–æ—Ä–æ</div>
                      </div>
                      
                      <div class="project-card" style="opacity: 0.7;">
                          <h3>üì± –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
                          <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–µ–≥–æ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>
                          <div class="tech-stack">
                              <span class="tech-tag">Flutter</span>
                              <span class="tech-tag">Dart</span>
                          </div>
                          <div class="project-link" style="background: #ccc;">–°–∫–æ—Ä–æ</div>
                      </div>
                  </div>
              </section>
              
              <section>
                  <h2>üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h2>
                  <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 20px;">
                      <span style="background: #3776AB; color: white; padding: 8px 16px; border-radius: 20px;">Python</span>
                      <span style="background: #61dafb; color: #000; padding: 8px 16px; border-radius: 20px;">React</span>
                      <span style="background: #339933; color: white; padding: 8px 16px; border-radius: 20px;">Node.js</span>
                      <span style="background: #02569B; color: white; padding: 8px 16px; border-radius: 20px;">Flutter</span>
                      <span style="background: #F7DF1E; color: #000; padding: 8px 16px; border-radius: 20px;">JavaScript</span>
                      <span style="background: #E34F26; color: white; padding: 8px 16px; border-radius: 20px;">HTML/CSS</span>
                      <span style="background: #4479A1; color: white; padding: 8px 16px; border-radius: 20px;">PostgreSQL</span>
                  </div>
              </section>
              
              <section style="margin-top: 40px; padding: 30px; background: #f8f9fa; border-radius: 15px;">
                  <h2>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
                  <p>–°–≤—è–∂–∏—Ç–µ—Å—å —Å–æ –º–Ω–æ–π –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞:</p>
                  <p>
                      <strong>GitHub:</strong> 
                      <a href="https://github.com/RomanLarichev">github.com/RomanLarichev</a>
                  </p>
                  <p><em>–ë–æ–ª—å—à–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏...</em></p>
              </section>
              
              <footer>
                  <p>üìç –°–∞–π—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç —á–µ—Ä–µ–∑ GitHub Actions</p>
                  <p>üìÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="current-date"></span></p>
                  <p>
                      <a href="https://github.com/RomanLarichev" style="color: #0366d6;">GitHub –ø—Ä–æ—Ñ–∏–ª—å</a> ‚Ä¢ 
                      <a href="https://github.com/RomanLarichev/portfolio" style="color: #0366d6;">–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</a>
                  </p>
              </footer>
              
              <script>
                  document.getElementById('current-date').textContent = 
                      new Date().toLocaleDateString('ru-RU', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                      });
              </script>
          </body>
          </html>
          HTML
          
          echo "‚úÖ –°–∞–π—Ç —Å–æ–∑–¥–∞–Ω –≤ –ø–∞–ø–∫–µ _site/"
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_site
          publish_branch: gh-pages
          force_orphan: true